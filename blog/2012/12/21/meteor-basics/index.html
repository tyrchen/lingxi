
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Meteor基础入门 - 觅珠人</title>
  <meta name="author" content="Tyr Chen">

  
  <meta name="description" content="安装 安装nodejs 可以通过brew install nodejs 或 sudo apt-get install nodejs 安装。不过版本也许不是最新的，所以建议到 http://nodejs.org/download/ 直接下载对应系统下的安装包。如果你是windows的用户，我想说， &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="baidu-site-verification" content="1dedb39f1479f3d48f42187eff43481f"/>

  
  <link rel="canonical" href="http://tyrchen.github.com/lingxi/blog/2012/12/21/meteor-basics/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="觅珠人" type="application/atom+xml">
  <link href='http://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
</head>

<body   >
  <header role="banner"><hgroup>
  <div id="logo">
  	<div id="logoLeft">{</div>
  	<div id="logoText">mzr</div>
  	<div id="logoRight">}</div>
  	<div class="clear"></div>
  </div>
  <h1><a href="/">觅珠人</a></h1>
  
    <h2>关于创业, 思考, 人生，技术，开源项目等的一切</h2>
  
  <div class="clear"></div>
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:tyrchen.github.com/lingxi" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">博客</a></li>
  <li><a href="/blog/categories/tools/">实用工具</a></li>
  <li><a href="/blog/categories/meteor/">Meteor进行时</a></li>
	<li><a href="/blog/categories/opensource/">开源软件</a></li>
	<li><a href="/blog/categories/technology/">产品·技术</a></li>
	<li><a href="/blog/categories/thoughts/">思考·人生</a></li>
	
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      
        <h1 class="entry-title">Meteor基础入门
          
          <br/><small> — 安装，包管理及基本元素 </small>
          
        </h1>
      
    
    
      <p class="meta">
        








  


<time datetime="2012-12-21T08:55:00+08:00" pubdate data-updated="true">Dec 21<span>st</span>, 2012</time>
        
      </p>
    
  </header>



<!-- Baidu Button BEGIN -->
<!-- later we could make this more general -->
<div id="bdshare" class="bdshare_t bds_tools_32 get-codes-bdshare" style="float:right;">
<a class="bds_tsina"></a>
<a class="bds_tqq"></a>
<a class="bds_renren"></a>
<a class="bds_mail"></a>
<a class="bds_print"></a>
<!-- span class="bds_more"></span -->
<a class="shareCount"></a>
</div>
<div style="clear:both;"></div>
<script type="text/javascript" id="bdshare_js" data="type=tools&amp;uid=6554625" ></script>
<script type="text/javascript" id="bdshell_js"></script>
<script type="text/javascript">
document.getElementById("bdshell_js").src = "http://bdimg.share.baidu.com/static/js/shell_v2.js?cdnversion=" + Math.ceil(new Date()/3600000)
</script>
<!-- Baidu Button END -->

<div class="entry-content"><h2>安装</h2>

<h3>安装nodejs</h3>

<p>可以通过<code>brew install nodejs</code> 或 <code>sudo apt-get install nodejs</code> 安装。不过版本也许不是最新的，所以建议到 <a href="http://nodejs.org/download/">http://nodejs.org/download/</a> 直接下载对应系统下的安装包。如果你是windows的用户，我想说，接下来的旅程对你而言将是无尽的折腾，我要是你，要么合上笔记本，远离这篇文章；要么咬咬牙，卖半个肾，去搞台mbp回来。</p>

<!-- more -->


<p>安装完成后， 测试一下版本号：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>tchen@tchen-mbp:~$ node -v
</span><span class='line'>v0.8.5
</span><span class='line'>tchen@tchen-mbp:~$ npm -v
</span><span class='line'>1.1.59</span></code></pre></td></tr></table></div></figure>


<p>最新的meteor需要nodejs 0.8.x版本支持。</p>

<h3>安装mongodb</h3>

<p>Meteor目前的版本与mongodb紧密绑定，所以你需要安装mongodb（<a href="http://baike.baidu.com/view/3385614.htm">mongodb是什么？</a>）。建议去官网下载最新版本安装：
<a href="http://www.mongodb.org/downloads">http://www.mongodb.org/downloads</a>。</p>

<p>安装完成后，可以用 <code>mongod</code> 命令启动数据库服务器，用 <code>mongo</code> 命令打开命令行界面访问mongodb。</p>

<h3>安装Meteor</h3>

<p>Meteor的安装很简单，通过如下命令就可以安装一个官方的最新稳定版本：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ curl https://install.meteor.com | /bin/sh</span></code></pre></td></tr></table></div></figure>


<p>如果你和我一样，喜欢cutting edge的刺激，可以 <code>clone</code> meteor的repo，并切换至devel branch，然后安装：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ git clone git://github.com/meteor/meteor.git
</span><span class='line'>$ cd meteor
</span><span class='line'>$ git checkout devel
</span><span class='line'>$ sudo ./install.sh</span></code></pre></td></tr></table></div></figure>


<p>安装脚本会先下载dependency kit，然后安装整个framework。</p>

<h2>第一个项目</h2>

<h3>创建</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ meteor create meteor-example
</span><span class='line'>meteor-example: created.
</span><span class='line'>
</span><span class='line'>To run your new app:
</span><span class='line'>   cd meteor-example
</span><span class='line'>   meteor
</span><span class='line'>$ cd meteor-example
</span><span class='line'>$ meteor
</span><span class='line'>[[[[[ ~/projects/meteor-example ]]]]]
</span><span class='line'>
</span><span class='line'>Running on: http://localhost:3000/</span></code></pre></td></tr></table></div></figure>


<p>在浏览器中打开 <a href="http://localhost:3000/">http://localhost:3000/</a> 就可以访问这个项目了。</p>

<h3>探索新建的项目</h3>

<p>进入到meteor-example目录后，<code>ls -la</code> 可以看到项目的目录结构：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ ls -la
</span><span class='line'>total 24
</span><span class='line'>drwxr-xr-x   6 tchen  staff   204 12 22 10:10 .
</span><span class='line'>drwxr-xr-x  47 tchen  staff  1598 12 22 10:10 ..
</span><span class='line'>drwxr-xr-x   5 tchen  staff   170 12 22 10:10 .meteor
</span><span class='line'>-rw-r--r--   1 tchen  staff    31 12 22 10:10 meteor-example.css
</span><span class='line'>-rw-r--r--   1 tchen  staff   193 12 22 10:10 meteor-example.html
</span><span class='line'>-rw-r--r--   1 tchen  staff   433 12 22 10:10 meteor-example.js</span></code></pre></td></tr></table></div></figure>


<p>其中有一个隐藏的文件夹 <code>.meteor</code>，它记载了当前项目的配置信息，运行时所需要的各种文件，以及项目的local db（第一次启动meteor的时候会自动生成）。</p>

<p>我们来看看 <code>.meteor/packages</code> 里记录了什么：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ cat .meteor/packages
</span><span class='line'># Meteor packages used by this project, one per line.
</span><span class='line'>#
</span><span class='line'># 'meteor add' and 'meteor remove' will edit this file for you,
</span><span class='line'># but you can also edit it by hand.
</span><span class='line'>
</span><span class='line'>autopublish
</span><span class='line'>insecure
</span><span class='line'>preserve-inputs
</span></code></pre></td></tr></table></div></figure>


<p>这是Meteor用来进行包管理的配置文件，它记录了你的项目里用了那些packages。</p>

<ul>
<li>autopublish是一个用来自动发布服务器端collection到客户端的库。</li>
<li>insecure是一个允许客户端对服务器端publish出来的数据有全部read/write权限的库。</li>
<li>preserve-inputs比较难解释一些，它指在meteor自动更新dom时，对于form中的各种输入组件，不重新生成。具体见：<a href="http://http://docs.meteor.com/">http://http://docs.meteor.com/</a>。</li>
</ul>


<h3>Meteor命令行介绍</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ meteor --help
</span><span class='line'>Usage: meteor [--version] [--help] &lt;command&gt; [&lt;args&gt;]
</span><span class='line'>
</span><span class='line'>With no arguments, 'meteor' runs the project in the current
</span><span class='line'>directory in local development mode. You can run it from the root
</span><span class='line'>directory of the project or from any subdirectory.
</span><span class='line'>
</span><span class='line'>Use 'meteor create &lt;name&gt;' to create a new Meteor project.
</span><span class='line'>
</span><span class='line'>Commands:
</span><span class='line'>   run        [default] Run this project in local development mode
</span><span class='line'>   create     Create a new project
</span><span class='line'>   update     Upgrade to the latest version of Meteor
</span><span class='line'>   add        Add a package to this project
</span><span class='line'>   remove     Remove a package from this project
</span><span class='line'>   list       List available packages
</span><span class='line'>   bundle     Pack this project up into a tarball
</span><span class='line'>   mongo      Connect to the Mongo database for the specified site
</span><span class='line'>   deploy     Deploy this project to Meteor
</span><span class='line'>   logs       Show logs for specified site
</span><span class='line'>   reset      Reset the project state. Erases the local database.
</span><span class='line'>
</span><span class='line'>See 'meteor help &lt;command&gt;' for details on a command.</span></code></pre></td></tr></table></div></figure>


<h4>meteor list</h4>

<p>列出meteor支持的package。注意，meteor的package（也自诩为smark package）和npm package不是一回事。meteor有自己的一套生态系统。以下所列的package都是开箱即用，用meteor add/remove安装/卸载即可。聪明如你一定会想到其实meteor add/remove就是修改 <code>.meteor/packages</code> 文件。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ meteor list
</span><span class='line'>
</span><span class='line'>accounts-base           A user account system
</span><span class='line'>accounts-facebook       Login service for Facebook accounts
</span><span class='line'>accounts-github         Login service for Github accounts
</span><span class='line'>accounts-google         Login service for Google accounts
</span><span class='line'>accounts-password       Password support for accounts.
</span><span class='line'>accounts-twitter        Login service for Twitter accounts
</span><span class='line'>accounts-ui             Simple templates to add login widgets to an app.
</span><span class='line'>accounts-ui-unstyled    Unstyled version of login widgets
</span><span class='line'>accounts-weibo          Login service for Sina Weibo accounts
</span><span class='line'>amplify                 API for Persistant Storage, PubSub and Request
</span><span class='line'>autopublish             Automatically publish the entire database to all clients
</span><span class='line'>backbone                A minimalist client-side MVC framework
</span><span class='line'>bootstrap               UX/UI framework from Twitter
</span><span class='line'>code-prettify           Syntax highlighting of code, from Google
</span><span class='line'>coffeescript            Javascript dialect with fewer braces and semicolons
</span><span class='line'>d3                      Library for manipulating documents based on data.
</span><span class='line'>email                   Send email messages
</span><span class='line'>force-ssl               Require this application to use secure transport (HTTPS)
</span><span class='line'>handlebars              Simple semantic templating language
</span><span class='line'>htmljs                  Easy macros for generating DOM elements in Javascript
</span><span class='line'>http                    Make HTTP calls to remote servers
</span><span class='line'>insecure                Allow all database writes by default
</span><span class='line'>jquery                  Manipulate the DOM using CSS selectors
</span><span class='line'>jquery-history          pushState module from the jQuery project
</span><span class='line'>jquery-layout           Easily create arbitrary multicolumn layouts
</span><span class='line'>jquery-waypoints        Execute a function when the user scrolls past an element
</span><span class='line'>less                    The dynamic stylesheet language.
</span><span class='line'>localstorage-polyfill   Simulates the localStorage API on IE 6,7 using userData
</span><span class='line'>madewith                Made With Meteor badge
</span><span class='line'>preserve-inputs         Automatically preserve all form fields with a unique id
</span><span class='line'>showdown                Markdown-to-HTML processor
</span><span class='line'>spiderable              Makes the application crawlable to web spiders.
</span><span class='line'>stylus                  Expressive, dynamic, robust CSS.
</span><span class='line'>underscore              Collection of small helper functions: _.map, _.each, ...</span></code></pre></td></tr></table></div></figure>


<h4>meteor mongo</h4>

<p>由于meteor的db放在 <code>.meteor/local/db</code> 下，所以使用 <code>mongo</code> 命令行查看系统db找不到meteor的数据库。meteor提供了自己的mongo cli供调试使用，这条命令运行前必须保证Meteor server处于开启状态。即运行了 <code>meteor</code> 命令。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ meteor mongo
</span><span class='line'>MongoDB shell version: 2.2.1
</span><span class='line'>connecting to: 127.0.0.1:3002/meteor
</span><span class='line'>&gt; show dbs
</span><span class='line'>local (empty)</span></code></pre></td></tr></table></div></figure>


<h3>小试牛刀</h3>

<p>我们先安装几个package，看看meteor的威力。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ meteor add accounts-ui
</span><span class='line'>accounts-ui: Simple templates to add login widgets to an app.
</span><span class='line'>$ meteor add accounts-weibo
</span><span class='line'>accounts-weibo: Login service for Sina Weibo accounts
</span><span class='line'>$ meteor add accounts-password
</span><span class='line'>accounts-password: Password support for accounts.
</span><span class='line'>$ meteor add jquery
</span><span class='line'>jquery: Manipulate the DOM using CSS selectors
</span><span class='line'>$ meteor add bootstrap
</span><span class='line'>bootstrap: UX/UI framework from Twitter
</span><span class='line'>$ meteor add underscore
</span><span class='line'>underscore: Collection of small helper functions: _.map, _.each, ...</span></code></pre></td></tr></table></div></figure>


<p>打开项目目录下的meteor-example.html，我们给它加上bootstrap的标准菜单，并添加loginButtons这个widget（是accounts-ui中定义的）：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;body&gt;</span>
</span><span class='line'>  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;navbar&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;navbar-inner&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;container&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">&quot;brand&quot;</span> <span class="na">href=</span><span class="s">&quot;#&quot;</span><span class="nt">&gt;</span>Meteor Example<span class="nt">&lt;/a&gt;</span>
</span><span class='line'>        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;nav-collapse collapse&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>          <span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">&quot;nav&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>            <span class="nt">&lt;li&gt;&lt;a</span> <span class="na">href=</span><span class="s">&quot;#&quot;</span><span class="nt">&gt;</span>{ { loginButtons } }<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
</span><span class='line'>          <span class="nt">&lt;/ul&gt;</span>
</span><span class='line'>        <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>      <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>  { { &gt; hello } }
</span><span class='line'><span class="nt">&lt;/body&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>打开浏览器，可以看到多了一个菜单，里面有一个登录按钮。点击该按钮，你会发现这个简单的项目目前已经支持weibo和邮件登录两种方式了。</p>

<h3>微博登录</h3>

<p>你需要先到 <a href="http://open.weibo.com/apps">http://open.weibo.com/apps</a> 创建你自己的微博app。将key和secret填入这里的微博接入配置窗口并按提示配置微博app，就可以使用了（大范围使用请先通过weibo app审核）。</p>

<h3>邮件登录</h3>

<p>点击 <code>create account</code>，输入邮箱和密码，创建一个账户。可以看到账号已创建，并且自动登录进来。</p>

<p>你可以继续试验登入，登出，忘记密码（注意，本地环境可能无法发送找回密码的邮件）。目前我们还没有撰写一行代码，已经有了一个完备的用户系统。</p>

<h2>深入了解</h2>

<p>如果你好奇这一切是怎么回事，那么请接着阅读。打开浏览器当前页面（http://localhost:3000）的console（建议使用chrome），尝试以下命令：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>&gt; $(document)
</span><span class='line'><span class="err">&lt;</span> [#document]
</span><span class='line'>&gt; _.max([1,2,3,4])
</span><span class='line'><span class="nt">&lt; 4</span>
</span></code></pre></td></tr></table></div></figure>


<p>神奇吧，上一步add了jquery和underscore这两个package后，你的项目已经自动包含了这两个库。接下保持在登录状态。在console中输入：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>&gt; Meteor.userId()
</span><span class='line'><span class="err">&lt;</span> &quot;dd0ed681-75e4-4d8c-b1fa-8b7dba8a2b16&quot;
</span><span class='line'>&gt; Meteor.user()
</span><span class='line'><span class="nt">&lt; Object</span>
</span><span class='line'><span class="na">_id:</span> <span class="err">&quot;</span><span class="na">dd0ed681-75e4-4d8c-b1fa-8b7dba8a2b16</span><span class="err">&quot;</span>
</span><span class='line'><span class="na">emails:</span> <span class="na">Array</span><span class="err">[</span><span class="na">1</span><span class="err">]</span>
</span><span class='line'><span class="na">0:</span> <span class="na">Object</span>
</span><span class='line'><span class="na">address:</span> <span class="err">&quot;</span><span class="na">a</span><span class="err">@</span><span class="na">b</span><span class="err">.</span><span class="na">com</span><span class="err">&quot;</span>
</span><span class='line'><span class="na">verified:</span> <span class="na">false</span>
</span><span class='line'><span class="na">__proto__:</span> <span class="na">Object</span>
</span><span class='line'><span class="na">length:</span> <span class="na">1</span>
</span><span class='line'><span class="na">__proto__:</span> <span class="na">Array</span><span class="err">[</span><span class="na">0</span><span class="err">]</span>
</span><span class='line'><span class="na">__proto__:</span> <span class="na">Object</span>
</span></code></pre></td></tr></table></div></figure>


<p>登出当前用户，在console中输入：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>&gt; Meteor.userId()
</span><span class='line'><span class="nt">&lt; null</span>
</span><span class='line'><span class="nt">&gt;</span> Accounts.createUser({email:&#39;e@f.com&#39;, password: &#39;123456&#39;})
</span><span class='line'><span class="nt">&lt; undefined</span> <span class="err">//</span> <span class="err">注意这个时候</span><span class="na">e</span><span class="err">@</span><span class="na">f</span><span class="err">.</span><span class="na">com</span><span class="err">已经是登录状态，见浏览器菜单栏。</span>
</span><span class='line'><span class="nt">&gt;</span> Meteor.userId()
</span><span class='line'><span class="err">&lt;</span> &quot;b9947f4f-0916-4ea9-88ea-7984b7f43875&quot;
</span><span class='line'>&gt; Meteor.logout()
</span><span class='line'>&gt; Meteor.loginWithPassword(&#39;e@f.com&#39;, &#39;123456&#39;)
</span><span class='line'><span class="nt">&lt; undefined</span> <span class="err">//</span> <span class="err">注意这个时候</span><span class="na">e</span><span class="err">@</span><span class="na">f</span><span class="err">.</span><span class="na">com</span><span class="err">又变成登录状态，见浏览器菜单栏。</span>
</span></code></pre></td></tr></table></div></figure>


<p>我们得出如下结论：</p>

<ul>
<li>Meteor会自动将package中用于客户端的js和css加载在浏览器中。</li>
<li>accounts-* 系列组件提供了用户系统所需的绝大多数功能，并提供了一个简单的ui，供快速开发。</li>
<li>Accounts对象和Meteor对象可以对用户进行创建，登录，退出等操作。</li>
<li>Meteor实时在服务器和客户端间交换数据。无论是登入/登出，还是创建用户，在client <-> server间的roundtrip中，只有数据在传输，页面的各种元素只有在第一次加载时才传输。</li>
</ul>


<h2>Meteor中的一些概念</h2>

<h3>Collection</h3>

<p>Meteor的Collection一旦定义后，在client/server端都可以访问。在meteor-example.js里输入如下代码创建collection：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">Messages</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Meteor</span><span class="p">.</span><span class="nx">Collection</span><span class="p">(</span><span class="s1">&#39;messages&#39;</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>在浏览器的console中可以访问该collection:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="o">&gt;</span> <span class="nx">Messages</span><span class="p">.</span><span class="nx">find</span><span class="p">().</span><span class="nx">fetch</span><span class="p">()</span>
</span><span class='line'><span class="o">&lt;</span> <span class="p">[]</span>
</span><span class='line'><span class="o">&gt;</span> <span class="nx">Messages</span><span class="p">.</span><span class="nx">insert</span><span class="p">({</span><span class="nx">username</span><span class="o">:</span> <span class="nx">Meteor</span><span class="p">.</span><span class="nx">user</span><span class="p">().</span><span class="nx">emails</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">address</span><span class="p">,</span> <span class="nx">content</span><span class="o">:</span> <span class="s1">&#39;Hello Hanmeimei, how are you?&#39;</span><span class="p">})</span>
</span><span class='line'><span class="o">&lt;</span> <span class="s2">&quot;21354a36-ec04-4b47-8000-e01ef2267c43&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>为了有更好的显示效果，我们再加一些代码显示Messages里的内容：</p>

<p>在meteor-example.html中我们加入一个新的template：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;template</span> <span class="na">name=</span><span class="s">&quot;message&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;hero-unit&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="nt">&lt;h1&gt;</span>Messages<span class="nt">&lt;/h1&gt;</span>
</span><span class='line'>    <span class="nt">&lt;ul&gt;</span>
</span><span class='line'>      { { #each messages } }
</span><span class='line'>      <span class="nt">&lt;li&gt;</span>{ { username } } says: { { content } }<span class="nt">&lt;/li&gt;</span>
</span><span class='line'>      { {/each } }
</span><span class='line'>    <span class="nt">&lt;/ul&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/div&gt;</span>
</span><span class='line'><span class="nt">&lt;/template&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>然后在body中引用它，在 <strong>{ { >hello } }</strong> 后，加入 <strong>{ { >message } }</strong>。</p>

<p>有了显示message的template，我们还需要提供数据的controller。在meteor-example.js中 if(&#8230;client)的scope中，加入新的message的controller：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">Template</span><span class="p">.</span><span class="nx">message</span><span class="p">.</span><span class="nx">messages</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="nx">Messages</span><span class="p">.</span><span class="nx">find</span><span class="p">()</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>现在看看浏览器中发生了什么变化。是滴！页面自动刷新，显示我们刚才创建的内容了。现在我们打开另外一个浏览器，进入 <a href="http://localhost:3000">http://localhost:3000</a>，用一个新的账户登录。然后在console里输入（这里建议使用firefox和chrome做测试）：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="o">&gt;</span> <span class="nx">Messages</span><span class="p">.</span><span class="nx">insert</span><span class="p">({</span><span class="nx">username</span><span class="o">:</span> <span class="nx">Meteor</span><span class="p">.</span><span class="nx">user</span><span class="p">().</span><span class="nx">emails</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">address</span><span class="p">,</span> <span class="nx">content</span><span class="o">:</span> <span class="s1">&#39;Hi Lilei, fine, thank you. And you?&#39;</span><span class="p">})</span>
</span><span class='line'><span class="o">&lt;</span> <span class="s2">&quot;c6ec8655-4644-48b2-a6be-7a3973dd7581&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>奇迹出现了，不仅仅是当前窗口得到了更新，另外一个浏览器有了最新的消息！我们仅仅写了几行代码，就已经见到一个实时聊天系统的雏形了！</p>

<p><img src="/images/snapshots/meteor-realtime.jpg"></p>

<h3>Live Update</h3>

<p>从刚才的例子中我们已经看到了Meteor的live update的威力。任何时候，当数据发生改变的时候，Meteor会自动在客户端重新渲染改动相关的DOM。</p>

<h3>Realtime</h3>

<p>借助socket.io，Meteor在server和每个客户端间保持了一个web socket连接。当有数据发生改变时，服务器会将新的数据publish到所有的客户端。这是Meteor的基因，因此，使用Meteor的任何app都天然具备realtime的特性。</p>

<h3>MVC</h3>

<p>Meteor不算是标准的MVC framework。如果非要往上套，Collection算是Model层，Template对象算是Controller层，而View是html中的template。</p>

<h2>后记</h2>

<p>今天就先写这么多，感兴趣的童鞋可以为聊天室加一个输入界面，这样说句话不必费劲地敲代码了。本文的完整代码可以在这里下载：
<a href="/downloads/chat.tgz">chat.tgz</a>。</p>

<p>依旧例，送上小宝今日照片。</p>

<p><img src="/images/photos/baby20121222-1.jpg"></p>

<p><img src="/images/photos/baby20121222-2.jpg"></p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Tyr Chen</span></span>

      








  


<time datetime="2012-12-21T08:55:00+08:00" pubdate data-updated="true">Dec 21<span>st</span>, 2012</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/meteor/'>meteor</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left articlenav" href="/blog/2012/12/19/atanasoff-product-flow-chart/" title="Previous Post: 进一步思考Atanasoff (Octopress client)">&laquo; 进一步思考Atanasoff (Octopress client)</a>
      
      
    </p>
  </footer>
</article>

<article class="archives">
  <div class="related-posts">
    <h2>相关文章</h2>
    <ul>
    
      <li><h4 class="title"><a href="/blog/2012/12/16/why-meteor/">为什么是Meteor - 它和我们熟悉的框架有何不同？</a></h4></li>
    
  </ul>
  </div>
</article>


  <section id="comment">
    <h1>发表评论</h1>
    
<!-- Duoshuo Comment BEGIN -->
	<div class="ds-thread"></div>
	<script type="text/javascript">
	var duoshuoQuery = {short_name:"tyrchen"};
	(function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = 'http://static.duoshuo.com/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0] 
		|| document.getElementsByTagName('body')[0]).appendChild(ds);
	})();
	</script>
<!-- Duoshuo Comment END -->

  </section>

</div>

<aside class="sidebar">
  
    
<section>
  <h1>新浪微博</h1>  
  <ul id="weibo">  
    <li>
      <iframe width="100%" height="250" class="share_self"  frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=250&fansRow=1&ptype=1&speed=0&skin=1&isTitle=1&noborder=1&isWeibo=1&isFans=1&uid=1737931304&verifier=58571e1f&dpc=1"></iframe>
    </li>  
  </ul>  
</section>  

<section>
  <h1>最新博文</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2012/12/21/meteor-basics/">Meteor基础入门</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/12/19/atanasoff-product-flow-chart/">进一步思考Atanasoff (Octopress client)</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/12/18/octopress-client-a-better-composition-tool/">产品随想：octopress客户端 —— Atanasoff</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/12/16/why-meteor/">为什么是Meteor</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/12/16/first-blog/">第一篇博客: 用octopress搭建博客系统</a>
      </li>
    
  </ul>
</section>

  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2012 - Tyr Chen -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
 	 - 欢迎转载，转载请携带 <a href="http://tyrchen.github.com/lingxi/blog/2012/12/21/meteor-basics/">原文网址</a> 及作者新浪微博地址 <a href="http://weibo.com/tchen82">陈天_Tyr</a> 
</p>

</footer>
  
<script type="text/javascript">
var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3F639096b5979f5825515e0f88f871f56c' type='text/javascript'%3E%3C/script%3E"));
</script>



</body>
</html>
