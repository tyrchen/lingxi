<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: meteor | 觅珠人]]></title>
  <link href="http://tyrchen.github.com/lingxi/blog/categories/meteor/atom.xml" rel="self"/>
  <link href="http://tyrchen.github.com/lingxi/"/>
  <updated>2012-12-24T09:24:27+08:00</updated>
  <id>http://tyrchen.github.com/lingxi/</id>
  <author>
    <name><![CDATA[Tyr Chen]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Meteor基础入门]]></title>
    <link href="http://tyrchen.github.com/lingxi/blog/2012/12/21/meteor-basics/"/>
    <updated>2012-12-21T08:55:00+08:00</updated>
    <id>http://tyrchen.github.com/lingxi/blog/2012/12/21/meteor-basics</id>
    <content type="html"><![CDATA[<h2>安装</h2>

<h3>安装nodejs</h3>

<p>可以通过<code>brew install nodejs</code> 或 <code>sudo apt-get install nodejs</code> 安装。不过版本也许不是最新的，所以建议到 <a href="http://nodejs.org/download/">http://nodejs.org/download/</a> 直接下载对应系统下的安装包。如果你是windows的用户，我想说，接下来的旅程对你而言将是无尽的折腾，我要是你，要么合上笔记本，远离这篇文章；要么咬咬牙，卖半个肾，去搞台mbp回来。</p>

<!-- more -->


<p>安装完成后， 测试一下版本号：</p>

<p><code>
tchen@tchen-mbp:~$ node -v
v0.8.5
tchen@tchen-mbp:~$ npm -v
1.1.59
</code></p>

<p>最新的meteor需要nodejs 0.8.x版本支持。</p>

<h3>安装mongodb</h3>

<p>Meteor目前的版本与mongodb紧密绑定，所以你需要安装mongodb（<a href="http://baike.baidu.com/view/3385614.htm">mongodb是什么？</a>）。建议去官网下载最新版本安装：
<a href="http://www.mongodb.org/downloads">http://www.mongodb.org/downloads</a>。</p>

<p>安装完成后，可以用 <code>mongod</code> 命令启动数据库服务器，用 <code>mongo</code> 命令打开命令行界面访问mongodb。</p>

<h3>安装Meteor</h3>

<p>Meteor的安装很简单，通过如下命令就可以安装一个官方的最新稳定版本：</p>

<p><code>
$ curl https://install.meteor.com | /bin/sh
</code></p>

<p>如果你和我一样，喜欢cutting edge的刺激，可以 <code>clone</code> meteor的repo，并切换至devel branch，然后安装：</p>

<p><code>
$ git clone git://github.com/meteor/meteor.git
$ cd meteor
$ git checkout devel
$ sudo ./install.sh
</code></p>

<p>安装脚本会先下载dependency kit，然后安装整个framework。</p>

<h2>第一个项目</h2>

<h3>创建</h3>

<p>```
$ meteor create meteor-example
meteor-example: created.</p>

<p>To run your new app:
   cd meteor-example
   meteor
$ cd meteor-example
$ meteor
[[[[[ ~/projects/meteor-example ]]]]]</p>

<p>Running on: http://localhost:3000/
```</p>

<p>在浏览器中打开 <a href="http://localhost:3000/">http://localhost:3000/</a> 就可以访问这个项目了。</p>

<h3>探索新建的项目</h3>

<p>进入到meteor-example目录后，<code>ls -la</code> 可以看到项目的目录结构：</p>

<p><code>
$ ls -la
total 24
drwxr-xr-x   6 tchen  staff   204 12 22 10:10 .
drwxr-xr-x  47 tchen  staff  1598 12 22 10:10 ..
drwxr-xr-x   5 tchen  staff   170 12 22 10:10 .meteor
-rw-r--r--   1 tchen  staff    31 12 22 10:10 meteor-example.css
-rw-r--r--   1 tchen  staff   193 12 22 10:10 meteor-example.html
-rw-r--r--   1 tchen  staff   433 12 22 10:10 meteor-example.js
</code></p>

<p>其中有一个隐藏的文件夹 <code>.meteor</code>，它记载了当前项目的配置信息，运行时所需要的各种文件，以及项目的local db（第一次启动meteor的时候会自动生成）。</p>

<p>我们来看看 <code>.meteor/packages</code> 里记录了什么：</p>

<p>```
$ cat .meteor/packages</p>

<h1>Meteor packages used by this project, one per line.</h1>

<p>#</p>

<h1>'meteor add' and 'meteor remove' will edit this file for you,</h1>

<h1>but you can also edit it by hand.</h1>

<p>autopublish
insecure
preserve-inputs</p>

<p>```</p>

<p>这是Meteor用来进行包管理的配置文件，它记录了你的项目里用了那些packages。</p>

<ul>
<li>autopublish是一个用来自动发布服务器端collection到客户端的库。</li>
<li>insecure是一个允许客户端对服务器端publish出来的数据有全部read/write权限的库。</li>
<li>preserve-inputs比较难解释一些，它指在meteor自动更新dom时，对于form中的各种输入组件，不重新生成。具体见：<a href="http://http://docs.meteor.com/">http://http://docs.meteor.com/</a>。</li>
</ul>


<h3>Meteor命令行介绍</h3>

<p>```
$ meteor --help
Usage: meteor [--version] [--help] <command> [<args>]</p>

<p>With no arguments, 'meteor' runs the project in the current
directory in local development mode. You can run it from the root
directory of the project or from any subdirectory.</p>

<p>Use 'meteor create <name>' to create a new Meteor project.</p>

<p>Commands:
   run        [default] Run this project in local development mode
   create     Create a new project
   update     Upgrade to the latest version of Meteor
   add        Add a package to this project
   remove     Remove a package from this project
   list       List available packages
   bundle     Pack this project up into a tarball
   mongo      Connect to the Mongo database for the specified site
   deploy     Deploy this project to Meteor
   logs       Show logs for specified site
   reset      Reset the project state. Erases the local database.</p>

<p>See 'meteor help <command>' for details on a command.
```</p>

<h4>meteor list</h4>

<p>列出meteor支持的package。注意，meteor的package（也自诩为smark package）和npm package不是一回事。meteor有自己的一套生态系统。以下所列的package都是开箱即用，用meteor add/remove安装/卸载即可。聪明如你一定会想到其实meteor add/remove就是修改 <code>.meteor/packages</code> 文件。
```
$ meteor list</p>

<p>accounts-base           A user account system
accounts-facebook       Login service for Facebook accounts
accounts-github         Login service for Github accounts
accounts-google         Login service for Google accounts
accounts-password       Password support for accounts.
accounts-twitter        Login service for Twitter accounts
accounts-ui             Simple templates to add login widgets to an app.
accounts-ui-unstyled    Unstyled version of login widgets
accounts-weibo          Login service for Sina Weibo accounts
amplify                 API for Persistant Storage, PubSub and Request
autopublish             Automatically publish the entire database to all clients
backbone                A minimalist client-side MVC framework
bootstrap               UX/UI framework from Twitter
code-prettify           Syntax highlighting of code, from Google
coffeescript            Javascript dialect with fewer braces and semicolons
d3                      Library for manipulating documents based on data.
email                   Send email messages
force-ssl               Require this application to use secure transport (HTTPS)
handlebars              Simple semantic templating language
htmljs                  Easy macros for generating DOM elements in Javascript
http                    Make HTTP calls to remote servers
insecure                Allow all database writes by default
jquery                  Manipulate the DOM using CSS selectors
jquery-history          pushState module from the jQuery project
jquery-layout           Easily create arbitrary multicolumn layouts
jquery-waypoints        Execute a function when the user scrolls past an element
less                    The dynamic stylesheet language.
localstorage-polyfill   Simulates the localStorage API on IE 6,7 using userData
madewith                Made With Meteor badge
preserve-inputs         Automatically preserve all form fields with a unique id
showdown                Markdown-to-HTML processor
spiderable              Makes the application crawlable to web spiders.
stylus                  Expressive, dynamic, robust CSS.
underscore              Collection of small helper functions: <em>.map, </em>.each, ...
```</p>

<h4>meteor mongo</h4>

<p>由于meteor的db放在 <code>.meteor/local/db</code> 下，所以使用 <code>mongo</code> 命令行查看系统db找不到meteor的数据库。meteor提供了自己的mongo cli供调试使用，这条命令运行前必须保证Meteor server处于开启状态。即运行了 <code>meteor</code> 命令。</p>

<p>```
$ meteor mongo
MongoDB shell version: 2.2.1
connecting to: 127.0.0.1:3002/meteor</p>

<blockquote><p>show dbs
local (empty)
```</p></blockquote>

<h3>小试牛刀</h3>

<p>我们先安装几个package，看看meteor的威力。</p>

<p><code>
$ meteor add accounts-ui
accounts-ui: Simple templates to add login widgets to an app.
$ meteor add accounts-weibo
accounts-weibo: Login service for Sina Weibo accounts
$ meteor add accounts-password
accounts-password: Password support for accounts.
$ meteor add jquery
jquery: Manipulate the DOM using CSS selectors
$ meteor add bootstrap
bootstrap: UX/UI framework from Twitter
$ meteor add underscore
underscore: Collection of small helper functions: _.map, _.each, ...
</code></p>

<p>打开项目目录下的meteor-example.html，我们给它加上bootstrap的标准菜单，并添加loginButtons这个widget（是accounts-ui中定义的）：</p>

<p>``` html
<body>
  <div class="navbar"></p>

<pre><code>&lt;div class="navbar-inner"&gt;
  &lt;div class="container"&gt;
    &lt;a class="brand" href="#"&gt;Meteor Example&lt;/a&gt;
    &lt;div class="nav-collapse collapse"&gt;
      &lt;ul class="nav"&gt;
        &lt;li&gt;&lt;a href="#"&gt;{ { loginButtons } }&lt;/a&gt;&lt;/li&gt;
      &lt;/ul&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/div&gt;
</code></pre>

<p>  </div>
  { { > hello } }
</body>
```</p>

<p>打开浏览器，可以看到多了一个菜单，里面有一个登录按钮。点击该按钮，你会发现这个简单的项目目前已经支持weibo和邮件登录两种方式了。</p>

<h3>微博登录</h3>

<p>你需要先到 <a href="http://open.weibo.com/apps">http://open.weibo.com/apps</a> 创建你自己的微博app。将key和secret填入这里的微博接入配置窗口并按提示配置微博app，就可以使用了（大范围使用请先通过weibo app审核）。</p>

<h3>邮件登录</h3>

<p>点击 <code>create account</code>，输入邮箱和密码，创建一个账户。可以看到账号已创建，并且自动登录进来。</p>

<p>你可以继续试验登入，登出，忘记密码（注意，本地环境可能无法发送找回密码的邮件）。目前我们还没有撰写一行代码，已经有了一个完备的用户系统。</p>

<h2>深入了解</h2>

<p>如果你好奇这一切是怎么回事，那么请接着阅读。打开浏览器当前页面（http://localhost:3000）的console（建议使用chrome），尝试以下命令：</p>

<p>```</p>

<blockquote><p>$(document)
&lt; [#document]
_.max([1,2,3,4])
&lt; 4
```</p></blockquote>

<p>神奇吧，上一步add了jquery和underscore这两个package后，你的项目已经自动包含了这两个库。接下保持在登录状态。在console中输入：</p>

<p>```</p>

<blockquote><p>Meteor.userId()
&lt; "dd0ed681-75e4-4d8c-b1fa-8b7dba8a2b16"
Meteor.user()
&lt; Object
_id: "dd0ed681-75e4-4d8c-b1fa-8b7dba8a2b16"
emails: Array[1]
0: Object
address: "a@b.com"
verified: false
<strong>proto</strong>: Object
length: 1
<strong>proto</strong>: Array[0]
<strong>proto</strong>: Object
```</p></blockquote>

<p>登出当前用户，在console中输入：
```</p>

<blockquote><p>Meteor.userId()
&lt; null
Accounts.createUser({email:'e@f.com', password: '123456'})
&lt; undefined // 注意这个时候e@f.com已经是登录状态，见浏览器菜单栏。
Meteor.userId()
&lt; "b9947f4f-0916-4ea9-88ea-7984b7f43875"
Meteor.logout()
Meteor.loginWithPassword('e@f.com', '123456')
&lt; undefined // 注意这个时候e@f.com又变成登录状态，见浏览器菜单栏。
```</p></blockquote>

<p>我们得出如下结论：</p>

<ul>
<li>Meteor会自动将package中用于客户端的js和css加载在浏览器中。</li>
<li>accounts-* 系列组件提供了用户系统所需的绝大多数功能，并提供了一个简单的ui，供快速开发。</li>
<li>Accounts对象和Meteor对象可以对用户进行创建，登录，退出等操作。</li>
<li>Meteor实时在服务器和客户端间交换数据。无论是登入/登出，还是创建用户，在client <-> server间的roundtrip中，只有数据在传输，页面的各种元素只有在第一次加载时才传输。</li>
</ul>


<h2>Meteor中的一些概念</h2>

<h3>Collection</h3>

<p>Meteor的Collection一旦定义后，在client/server端都可以访问。在meteor-example.js里输入如下代码创建collection：</p>

<p><code>javascript
var Messages = new Meteor.Collection('messages');
</code></p>

<p>在浏览器的console中可以访问该collection:</p>

<p>```</p>

<blockquote><p>Messages.find().fetch()
&lt; []
Messages.insert({username: Meteor.user().emails[0].address, content: 'Hello Hanmeimei, how are you?'})
&lt; "21354a36-ec04-4b47-8000-e01ef2267c43"
```</p></blockquote>

<p>为了有更好的显示效果，我们再加一些代码显示Messages里的内容：</p>

<p>在meteor-example.html中我们加入一个新的template：</p>

<p>``` html
<template name="message">
  <div class="hero-unit"></p>

<pre><code>&lt;h1&gt;Messages&lt;/h1&gt;
&lt;ul&gt;
  { { #each messages } }
  &lt;li&gt;{ { username } } says: { { content } }&lt;/li&gt;
  { {/each } }
&lt;/ul&gt;
</code></pre>

<p>  </div>
</template>
```</p>

<p>然后在body中引用它，在 <strong>{ { >hello } }</strong> 后，加入 <strong>{ { >message } }</strong>。</p>

<p>有了显示message的template，我们还需要提供数据的controller。在meteor-example.js中 if(...client)的scope中，加入新的message的controller：
``` javascript
Template.message.messages = function() {</p>

<pre><code>return Messages.find()
</code></pre>

<p>}
```</p>

<p>现在看看浏览器中发生了什么变化。是滴！页面自动刷新，显示我们刚才创建的内容了。现在我们打开另外一个浏览器，进入 <a href="http://localhost:3000">http://localhost:3000</a>，用一个新的账户登录。然后在console里输入（这里建议使用firefox和chrome做测试）：</p>

<p>```</p>

<blockquote><p>Messages.insert({username: Meteor.user().emails[0].address, content: 'Hi Lilei, fine, thank you. And you?'})
&lt; "c6ec8655-4644-48b2-a6be-7a3973dd7581"
```</p></blockquote>

<p>奇迹出现了，不仅仅是当前窗口得到了更新，另外一个浏览器有了最新的消息！我们仅仅写了几行代码，就已经见到一个实时聊天系统的雏形了！</p>

<p><img src="/images/snapshots/meteor-realtime.jpg"></p>

<h3>Live Update</h3>

<p>从刚才的例子中我们已经看到了Meteor的live update的威力。任何时候，当数据发生改变的时候，Meteor会自动在客户端重新渲染改动相关的DOM。</p>

<h3>Realtime</h3>

<p>借助socket.io，Meteor在server和每个客户端间保持了一个web socket连接。当有数据发生改变时，服务器会将新的数据publish到所有的客户端。这是Meteor的基因，因此，使用Meteor的任何app都天然具备realtime的特性。</p>

<h3>MVC</h3>

<p>Meteor不算是标准的MVC framework。如果非要往上套，Collection算是Model层，Template对象算是Controller层，而View是html中的template。</p>

<h2>后记</h2>

<p>今天就先写这么多，感兴趣的童鞋可以为聊天室加一个输入界面，这样说句话不必费劲地敲代码了。本文的完整代码可以在这里下载：
<a href="/downloads/chat.tgz">chat.tgz</a>。</p>

<p>依旧例，送上小宝今日照片。</p>

<p><img src="/images/photos/baby20121222-1.jpg"></p>

<p><img src="/images/photos/baby20121222-2.jpg"></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[为什么是Meteor]]></title>
    <link href="http://tyrchen.github.com/lingxi/blog/2012/12/16/why-meteor/"/>
    <updated>2012-12-16T14:29:00+08:00</updated>
    <id>http://tyrchen.github.com/lingxi/blog/2012/12/16/why-meteor</id>
    <content type="html"><![CDATA[<h2>Meteor是什么？</h2>

<p>Meteor的官网( http://meteor.com )这样介绍这个框架：</p>

<blockquote><p>Meteor is an open-source platform for building top-quality web apps in a fraction of the time, whether you're an expert developer or just getting started.</p></blockquote>

<p><strong>top-quality web apps</strong> 我们放下不表，<strong>fraction of the time</strong> 的提法很新颖，看来这个框架的目标是解放程序猿，少花时间多办事。虽然具体的演化路径我不得而知，但从网络上的各种蛛丝马迹来看，Meteor吸收了google wave, asana等平台背后的开发工具的精髓，逐渐演进出了目前的版本。Meteor的幕后团队相当强悍：他们大多毕业于MIT，是成功的创业家，也是一流的工程师，其中一个开发者还是神器 <a href="http://etherpad.net">etherpad</a> 的作者。</p>

<!-- more -->


<h3>Meteor究竟有什么NB的地方？</h3>

<p>首先，Meteor构架与nodejs之上。这使得 <strong>One Language</strong> 成为可能，同时可依托nodejs上诸如soket.io这样强大的类库内置 <strong>realtime</strong>，<strong>Date on the Wire</strong> 等特性。</p>

<p>在一种语言的基础上，Meteor统一了服务器端和客户端的数据访问，提出 <strong>Database Everywhere</strong>，一套DB API大大减轻了开发负担，不用再做server data JSON client data的转换（想想你的django 或者rails app，在这上面花了多少功夫？）。</p>

<p>为了让app达到最佳的用户体验，Meteor还提供了 <strong>Latency Compensation</strong>，客户端对数据的更新即时反应到UI，如果更新被服务器reject，再rollback。大多数情况下，用户会得到极佳的类似本地数据库的体验。</p>

<p>Meteor最让人叫绝的是其 <strong>Full Stack Reactivity</strong>。关于reactivity programming的详细介绍，请参考 <a href="http://en.wikipedia.org/wiki/Reactive_programming">Reactivity Programming</a>，这里不展开。简言之，当数据发生改变的时候，所有依赖该数据的地方自动发生相应的改变。</p>

<p>用过backbone的同学都知道，当model发生改变的时候，我们需要通过注册相应的事件，显式更新对应的DOM，如果数据在页面中多处被渲染，则每处对应的DOM需挨个更新。</p>

<p>ember在backbone的思想上更近了一大步，通过内置的data binding API，让数据和DOM能够双向绑定，程序猿不用再花心思去考虑DOM的更新。然而，蹩脚的API调用（所有对binding的数据的访问需要通过getter和setter，你懂的）和DOM中无处不在的script垃圾让ember既不简约也不优雅。</p>

<p>而Meteor则另辟蹊跷，通过reactivity context和dependency巧妙地支持了reactivity（据作者说核心代码就几十行），使用者几乎感受不到代码的变化。</p>

<p>Meteor另一个很贴心的点是零部署。开发web app有点小头疼的点是打包和部署。比如说，把less转成css，coffee转成javascript，然后混淆，压缩，虽然有些自动化的工具可以简化这部分工作，可还免不了相应的配置和一些脚本工作。在开发环境下，meteor会自动替你加载js/css，如果你使用了coffee/less (sass)，只要add了相应的smart package，meteor会自动帮你处理；开发完毕后要部署，只需要运行 <code>meteor bundle</code>，系统自动会将相关的资源打包，只要目标系统上有相应版本的nodejs，meteor和mongodb，就能运行一个标准的production版本。</p>

<p>以下是meteor官网上的介绍，当你真正使用meteor后，会发现还真不是吹牛。</p>

<blockquote><h2>Seven Principles of Meteor</h2>

<ol>
<li><p>Data on the Wire. Don't send HTML over the network. Send data and let the client decide how to render it.</p></li>
<li><p>One Language. Write both the client and the server parts of your interface in JavaScript.</p></li>
<li><p>Database Everywhere. Use the same transparent API to access your database from the client or the server.</p></li>
<li><p>Latency Compensation. On the client, use prefetching and model simulation to make it look like you have a zero-latency connection to the database.</p></li>
<li><p>Full Stack Reactivity. Make realtime the default. All layers, from database to template, should make an event-driven interface available.</p></li>
<li><p>Embrace the Ecosystem. Meteor is open source and integrates, rather than replaces, existing open source tools and frameworks.
Simplicity Equals Productivity. The best way to make something seem simple is to have it actually be simple. Accomplish this through clean, classically beautiful APIs.</p></li>
</ol>
</blockquote>

<h2>Meteor入门范例</h2>

<p>废话说那么多，是骡子是马，不如拿出来溜溜。以下是meteor create --example leaderboard产生的代码，很好懂，借花献佛。先看DOM结构，meteor目前仅支持 <a href="http://http://handlebarsjs.com/">handlebar</a> 做为template engine。</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span> (leaderboard.html)</span> <a href='/downloads/code/leaderboard.html'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;head&gt;</span>
</span><span class='line'>  <span class="nt">&lt;title&gt;</span>Leaderboard<span class="nt">&lt;/title&gt;</span>
</span><span class='line'><span class="nt">&lt;/head&gt;</span>
</span><span class='line'><span class="nt">&lt;body&gt;</span>
</span><span class='line'>  <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;outer&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    {{&gt; leaderboard}}
</span><span class='line'>  <span class="nt">&lt;/div&gt;</span>
</span><span class='line'><span class="nt">&lt;/body&gt;</span>
</span><span class='line'><span class="nt">&lt;template</span> <span class="na">name=</span><span class="s">&quot;leaderboard&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;leaderboard&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    {{#each players}}
</span><span class='line'>      {{&gt; player}}
</span><span class='line'>    {{/each}}
</span><span class='line'>  <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>  {{#if selected_name}}
</span><span class='line'>  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;details&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;name&quot;</span><span class="nt">&gt;</span>{{selected_name}}<span class="nt">&lt;/div&gt;</span>
</span><span class='line'>    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;button&quot;</span> <span class="na">class=</span><span class="s">&quot;inc&quot;</span> <span class="na">value=</span><span class="s">&quot;Give 5 points&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>  {{/if}}
</span><span class='line'>  {{#unless selected_name}}
</span><span class='line'>  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;none&quot;</span><span class="nt">&gt;</span>Click a player to select<span class="nt">&lt;/div&gt;</span>
</span><span class='line'>  {{/unless}}
</span><span class='line'><span class="nt">&lt;/template&gt;</span>
</span><span class='line'><span class="nt">&lt;template</span> <span class="na">name=</span><span class="s">&quot;player&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;player {{selected}}&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">&quot;name&quot;</span><span class="nt">&gt;</span>{{name}}<span class="nt">&lt;/span&gt;</span>
</span><span class='line'>    <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">&quot;score&quot;</span><span class="nt">&gt;</span>{{score}}<span class="nt">&lt;/span&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/div&gt;</span>
</span><span class='line'><span class="nt">&lt;/template&gt;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>可以看到html被简化了不少，不用显式应用js/css。这段代码很好懂。再看看javascript，也是leaderboard的核心功能。javascript文件主要实现了template的事件及数据的CRUD。</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span> (leaderboard.js)</span> <a href='/downloads/code/leaderboard.js'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="c1">// Set up a collection to contain player information. On the server,</span>
</span><span class='line'><span class="c1">// it is backed by a MongoDB collection named &quot;players&quot;.</span>
</span><span class='line'><span class="nx">Players</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Meteor</span><span class="p">.</span><span class="nx">Collection</span><span class="p">(</span><span class="s2">&quot;players&quot;</span><span class="p">);</span>
</span><span class='line'><span class="k">if</span> <span class="p">(</span><span class="nx">Meteor</span><span class="p">.</span><span class="nx">isClient</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">Template</span><span class="p">.</span><span class="nx">leaderboard</span><span class="p">.</span><span class="nx">players</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="nx">Players</span><span class="p">.</span><span class="nx">find</span><span class="p">({},</span> <span class="p">{</span><span class="nx">sort</span><span class="o">:</span> <span class="p">{</span><span class="nx">score</span><span class="o">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nx">name</span><span class="o">:</span> <span class="mi">1</span><span class="p">}});</span>
</span><span class='line'>  <span class="p">};</span>
</span><span class='line'>  <span class="nx">Template</span><span class="p">.</span><span class="nx">leaderboard</span><span class="p">.</span><span class="nx">selected_name</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">player</span> <span class="o">=</span> <span class="nx">Players</span><span class="p">.</span><span class="nx">findOne</span><span class="p">(</span><span class="nx">Session</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;selected_player&quot;</span><span class="p">));</span>
</span><span class='line'>    <span class="k">return</span> <span class="nx">player</span> <span class="o">&amp;&amp;</span> <span class="nx">player</span><span class="p">.</span><span class="nx">name</span><span class="p">;</span>
</span><span class='line'>  <span class="p">};</span>
</span><span class='line'>  <span class="nx">Template</span><span class="p">.</span><span class="nx">player</span><span class="p">.</span><span class="nx">selected</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="nx">Session</span><span class="p">.</span><span class="nx">equals</span><span class="p">(</span><span class="s2">&quot;selected_player&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_id</span><span class="p">)</span> <span class="o">?</span> <span class="s2">&quot;selected&quot;</span> <span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
</span><span class='line'>  <span class="p">};</span>
</span><span class='line'>  <span class="nx">Template</span><span class="p">.</span><span class="nx">leaderboard</span><span class="p">.</span><span class="nx">events</span><span class="p">({</span>
</span><span class='line'>    <span class="s1">&#39;click input.inc&#39;</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span><span class='line'>      <span class="nx">Players</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="nx">Session</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;selected_player&quot;</span><span class="p">),</span> <span class="p">{</span><span class="nx">$inc</span><span class="o">:</span> <span class="p">{</span><span class="nx">score</span><span class="o">:</span> <span class="mi">5</span><span class="p">}});</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">});</span>
</span><span class='line'>  <span class="nx">Template</span><span class="p">.</span><span class="nx">player</span><span class="p">.</span><span class="nx">events</span><span class="p">({</span>
</span><span class='line'>    <span class="s1">&#39;click&#39;</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span><span class='line'>      <span class="nx">Session</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s2">&quot;selected_player&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_id</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">});</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="c1">// On server startup, create some players if the database is empty.</span>
</span><span class='line'><span class="k">if</span> <span class="p">(</span><span class="nx">Meteor</span><span class="p">.</span><span class="nx">isServer</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">Meteor</span><span class="p">.</span><span class="nx">startup</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="nx">Players</span><span class="p">.</span><span class="nx">find</span><span class="p">().</span><span class="nx">count</span><span class="p">()</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="kd">var</span> <span class="nx">names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Ada Lovelace&quot;</span><span class="p">,</span>
</span><span class='line'>                   <span class="s2">&quot;Grace Hopper&quot;</span><span class="p">,</span>
</span><span class='line'>                   <span class="s2">&quot;Marie Curie&quot;</span><span class="p">,</span>
</span><span class='line'>                   <span class="s2">&quot;Carl Friedrich Gauss&quot;</span><span class="p">,</span>
</span><span class='line'>                   <span class="s2">&quot;Nikola Tesla&quot;</span><span class="p">,</span>
</span><span class='line'>                   <span class="s2">&quot;Claude Shannon&quot;</span><span class="p">];</span>
</span><span class='line'>      <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">names</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span>
</span><span class='line'>        <span class="nx">Players</span><span class="p">.</span><span class="nx">insert</span><span class="p">({</span><span class="nx">name</span><span class="o">:</span> <span class="nx">names</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span> <span class="nx">score</span><span class="o">:</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span><span class="o">*</span><span class="mi">10</span><span class="p">)</span><span class="o">*</span><span class="mi">5</span><span class="p">});</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">});</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>不到50行代码，提供了从model创建与fixture setup，到渲染模版和事件处理。想想用现有的任何一个框架，实现同样的功能，需要多少代码？</p>

<p>要运行以上范例，安装好meteor后，仅需：</p>

<p><code>
$ meteor create --example leaderboard
$ cd leaderboard
$ meteor
</code></p>

<p>然后打开浏览器，访问：http://localhost:3000。</p>

<h2>敬请期待</h2>

<p>从meteor 0.3.8版本开始学习和使用，到目前的0.5.2，我对meteor虽不敢说已经通盘掌握，也能够做一些稍微复杂的项目。接下来我会撰写一系列的文章，从本文提到的例子leaderboard的增强版开始，由浅入深，探讨如何通过学习meteor的架构和API，使用meteor做一些有意思的项目。</p>

<p>大纲如下：</p>

<ul>
<li><strong>Meteor入门指南 - 如何安装，基本元素和包管理</strong> -- 2012.12.23前</li>
<li><strong>第一个Meteor App: 正字系统（leaderboard变种）</strong> -- 2012.12.30前</li>
<li><strong>Meteor的权限和用户账号系统</strong> -- 2013.01.06前</li>
<li><strong>将Meteor部署到自己的服务器</strong> -- 2013.01.13前</li>
</ul>


<h2>Reference</h2>

<ol>
<li><a href="http://meteor.com">http://meteor.com</a></li>
<li><a href="http://docs.meteor.com">Meteor文档</a></li>
<li><a href="https://trello.com/board/meteor-roadmap/508721606e02bb9d570016ae">Meteor Roadmap</a></li>
</ol>


<h2>小宝的照片</h2>

<p>依旧例，还是上一张小宝的当天照片以飨读者。</p>

<p><img src="/images/photos/baby20121216-1.jpg"></p>
]]></content>
  </entry>
  
</feed>
